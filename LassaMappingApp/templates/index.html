<!-- templates/index.html -->
<html>
	<head>
		<title>Lassa Virus Dashboard</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/lux/bootstrap.min.css" integrity="sha384-9+PGKSqjRdkeAU7Eu4nkJU8RFaH8ace8HGXnkiKMP9I9Te0GJ4/km3L1Z8tXigpG" crossorigin="anonymous">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="anonymous" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.css" integrity="sha512-RLEjtaFGdC4iQMJDbMzim/dOvAu+8Qp9sw7QE4wIMYcg2goVoivzwgSZq9CsIxp4xKAZPKh5J2f2lOko2Ze6FQ==" crossorigin="anonymous" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css" integrity="sha512-BBToHPBStgMiw0lD4AtkRIZmdndhB6aQbXpX7omcrXeG2PauGBl2lzq2xUZTxaLxYz5IDHlmneCZ1IJ+P3kYtQ==" crossorigin="anonymous" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet-src.js" integrity="sha512-I5Hd7FcJ9rZkH7uD01G3AjsuzFy3gqz7HIJvzFZGFt2mrCS4Piw9bYZvCgUE0aiJuiZFYIJIwpbNnDIM6ohTrg==" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js" integrity="sha512-MQlyPV+ol2lp4KodaU/Xmrn+txc1TP15pOBF/2Sfre7MRsA/pB4Vy58bEqe9u7a7DczMLtU5wT8n7OblJepKbg==" crossorigin="anonymous"></script>
		<script   src="https://code.jquery.com/jquery-3.5.1.js"   integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="   crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<style>a.active.nav-link{background-color: #f0ad4e!important;}</style>
	</head>
	<nav class="navbar navbar-expand-lg navbar-light bg-light" role="navigation">
  		<a class="navbar-brand" href="{{ url_for('main_page') }}">Lassa Virus Dashboard</a>
  		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNavBar" aria-controls="mainNavBar" aria-expanded="false" aria-label="Toggle navigation">
    			<span class="navbar-toggler-icon"></span>
  		</button>

		<div class="collapse navbar-collapse" id="mainNavBar">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item">
        				<a class="nav-link" href="{{ url_for('download_page') }}">Download</a>
                                <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('login') }}">Login</a>
			</ul>
  
		</div>
	</nav>

	<body>
		<div class="jumbotron">
		<p style="text-align: left; max-width: 800px; margin-left: auto; margin-right: auto;">
			This dashboard is designed to provide a comprehensive visualization of publicly available data on the distribution of Lassa virus across West Africa. Data was compiled from peer-reviewed publications and GenBank. The geographic distribution of the data can be visualized by zooming in on the map icons. The temporal distribution of the data can be visualized in the bar chart.
		</p>
		</div>
		<div class="row justify-content-center">
			<div class="card border-light mb-3 mr-3" style="width: 15rem;">
				<div class="card-body", style="text-align:center;">
					<img src="/static/images/custom_world2.png"></img> <br>
					<p style="color: #1a1a1a">
						<span style="font-size:30px;"><b>{{data_summary[0]}}</b></span><br>
						<span style="font-size:13px;">Countries Represented</span>
					</p>
				</div>
			</div>
			<div class="card border-light mb-3 mr-3" style="width: 15rem;">
				<div class="card-body" style="text-align:center;">
					<img src="/static/images/custom_study2.png"></img><br>
					<p style="color: #1a1a1a">
						<span style="font-size:30px;"><b>{{data_summary[4]}}</b></span><br>
						<span style="font-size:13px;">Source Studies</span>
					</p>
				</div>
			</div>
			<div class="card border-light mb-3 mr-3" style="width: 15rem;">
				<div class="card-body" style="text-align:center;">
					<img src="/static/images/custom_rodent3.png"></img><br>
					<p style="color: #1a1a1a">
						<span style="font-size:30px;"><b>{{data_summary[1]}}</b></span><br>
						<span style="font-size:13px;">Rodent Point Samples</span>
					</p>
				</div>
			</div>
			<div class="card border-light mb-3 mr-3" style="width: 15rem;">
				<div class="card-body" style="text-align:center;">
					<img src="/static/images/custom_human2.png"></img><br>
					<p style="color: #1a1a1a">
						<span style="font-size:30px;"><b>{{data_summary[2]}}</b></span><br>
						<span style="font-size:13px;">Human Point Samples</span>
					</p>
				</div>
			</div>
			<div class="card border-light mb-3 mr-3" style="width: 15rem;">
				<div class="card-body" style="text-align:center;">
					<img src="/static/images/custom_LASV.png"></img><br>
					<p style="color: #1a1a1a">
						<span style="font-size:30px;"><b>{{data_summary[3]}}</b></span><br>
						<span style="font-size:13px;">Lassa Sequences</span>
					</p>
				</div>
			</div>
		</div>
		<div class="container-fluid" id="MainContain">
			<div class="row">
				<div class="col-lg-8">
					<div class="card" style="height: 88vh;" id="mapCard">
						<div class="card-body" style="overflow: auto;">
							<p style="text-align: left; color: #1a1a1a; margin-top:10px">The spatial distribution of Lassa virus samples in the available published data. Data points can be viewed by clicking on the clusters until individual icons appear (human icon, rodent icon, or sequence icon). Mapped data can be filtered by a range of years, found in the top left corner of the map. <b>Select a tab below to begin mapping.</b> </p>
							<ul class="nav nav-tabs nav-justified" id="myTabs">
								<li class="nav-item" style="margin-left:0px;margin-right:0px; display: flex; flex: 1;">
									<a class="nav-link" id="HumanTab" href="#LassaHumans" style="border-color: #dfdfdf; border-bottom: transparent; flex: 1;">Viral Infection: Humans</a>
								</li>
								<li class="nav-item" style="margin-left:0px;margin-right:0px; display: flex; flex: 1;">
									<a class="nav-link" id="RodentTab" href="#LassaRodents" style="border-color: #dfdfdf; border-bottom: transparent; flex: 1;">Viral Infection: Rodents</a>
								</li>
								<li class="nav-item" style="margin-left:0px;margin-right:0px; display: flex; flex: 1;">
									<a class="nav-link" id="SequenceRodentTab", href="#LassaSequenceRodents" style="border-color: #dfdfdf; border-bottom: transparent; flex: 1;">Viral Sequences: Rodents</a>
								<li>
                                                                <li class="nav-item" style="margin-left:0px;margin-right:0px; display: flex; flex: 1;">
                                                                        <a class="nav-link" id="SequenceHumanTab", href="#LassaSequenceHumans" style="border-color: #dfdfdf; border-bottom: transparent; flex: 1;">Viral Sequences: Humans</a>
                                                                <li>

							</ul>
							<div class="tab-content" id="myTabContent" style="position: sticky">
  								<div class="tab-pane fade in show active" id="LassaHumans">
									<div id="MapWrapper" style="height: 77%; width:100%; margin:auto;">
                                                                        	<div class="row" style="position: absolute; z-index:2; width: 150px; left:50px; bottom:315px" id="yearFilter">
											<div class="col" style="width:65px; height:30px;">
                                                                                		<div class="form-group">
                                                                                        		<label for="StartYear"></label>
                                                                                        		<select class="form-control" style="position: absolute; z-index:3; padding: 0px;" name="StartYear" id="StartYear"></select>
                                                                                		</div>
											</div>
											<div class="col" style="width:65px; height:30px; margin:1px">
                                                                                		<div class="form-group">
                                                                                      	  		<label for="EndYear"></label>
                                                                                        		<select class="form-control" style="position: absolute; z-index:3; padding: 0px;" name="EndYear" id="EndYear"></select>
                                                                                		</div>
											</div>
                                                                        	</div>
										<div id="map" style="height:90%; width:100%; position: relative; z-index:1;"></div>
									</div>
								</div>
								<div class="tab-pane fade in" id="LassaRodents">
									<div id="map" style="height:90%; width:100%; position: relative; z-index:1;"></div>
								</div>
								<div class="tab-pane fade in" id="LassaSequenceRodents">
									<div id="map" style="height:90%; width:100%; position: relative; z-index:1;"></div>
								</div>
                                                                <div class="tab-pane fade in" id="LassaSequenceHumans">
                                                                        <div id="map" style="height:90%; width:100%; position: relative; z-index:1;"></div>
                                                                </div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-4">
					<div class="card" style="height: 88vh">
						<div class="card-body" style="overflow: auto" id="ChartCard">
							<p style="text-align: left; color: #1a1a1a; margin-top:10px;">To view the diagnostic methods that were used to identify the viral infection data, click on the chart legend. Note that the number of sequences displayed on the map may differ from chart statistics, as some sequences do not have an associated Latitude and Longitude.</p>
							<div id='HumanDiv' style="width:100%"></div>
							<div id='RodentDiv' style="width:100%"></div>
							<div id='SeqHumanDiv' style="width:100%"></div>
							<div id='SeqRodentDiv' style="width:100%"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	<footer id="footer" style="text-align: center; margin-top:30px;">
		<div class="row">
			<div class="col">
				<ul class="list-unstyled" style="display: inline-flex;">
					<li style="margin-left:10px;">
						<p style="color: #1a1a1a; margin-top: 5px;">
							<span style="font-size:13px">
								Powered by 
								<a href="https://www.northwestknowledge.net" style="font-size:150%;" target="_blank">NKN</a>
							</span>
						</p>
					</li>
                                        <li style="margin-left:10px;">
						<p style="color: #1a1a1a; margin-top: 5px;">
							<span style="font-size:13px">
								<img src="/static/images/LE3F_Logo.png" style="height:38px; width:auto;"></img>
                                                		<a href="https://www.leeef.org" style="font-size:150%;" target="_blank">LE3F<a>
							</span>
						</p>
                                        </li>
				</ul>
			</div>
		</div>
	</footer>
	<script src="/static/lassaMapping.js" type="text/javascript"></script>
	<script src = "/static/lassaCharts.js" type="text/javascript"></script>
	<script>
		$(window).on("resize", function(){
			var filterTop = $('#map').position().top + 4;
			var filterLeft = $('#map').position().left + 55;
			$('#yearFilter').css({'top': filterTop, 'left':filterLeft});
		});
		var mapOptions = {};
		$(document).ready(function(){
    			if(window.matchMedia("(max-width: 767px)").matches){
        		// The viewport is less than 768 pixels wide
				var newMapHeight = $('#map').height() - 50;
				$('#map').css({'height': newMapHeight});
    			} else{
        		// The viewport is at least 768 pixels wide
                        	var filterTop = $('#map').position().top + 4;
                        	var filterLeft = $('#map').position().left + 55;
                        	$('#yearFilter').css({'top': filterTop, 'left':filterLeft});
    			}
		});
		var host = {};
		var propAb = {};
		var propAg = {};
		function humanMap(){
			var chartPars = {visual: "chart"};
			var mapPars = {visual: "map"};
			$.ajax({async:false, url:"/LassaHumans", data:chartPars, dataType:"json",
				success: function(data){
					propAb = data;
				}
			});
			$.ajax({async:false, url:"/LassaHumans", data:mapPars, dataType:"json",
				success: function(data){
					mapYearData = data;
                                        end_year_select.empty();
                                        start_year_select.empty();
					for (var i in mapYearData.end_year){
						end_year_select.append($('<option>', {value: mapYearData.end_year[i], text: mapYearData.end_year[i]}, '</option>'))
					};
					for (var j in mapYearData.start_year){
						start_year_select.append($('<option>', {value: mapYearData.start_year[j], text: mapYearData.start_year[j]}, '</option>'))
					}
				}
			});
			host = mapYearData.host;
			propAb = propAb;
		};
		function rodentMap(){
			var chartPars = {visual: "chart"};
			var mapPars = {visual: "map"};
			$.ajax({async:false, url:"/LassaRodents", data:chartPars, dataType:"json",
				success: function(data){
					propAb = data[0];
					propAg = data[1];
				}
			});
			$.ajax({async:false, url:"/LassaRodents", data:mapPars, dataType:"json",
				success: function(data){
					mapYearData = data;
                                        end_year_select.empty();
                                        start_year_select.empty();
                                        for (var i in mapYearData.end_year){
                                                end_year_select.append($('<option>', {value: mapYearData.end_year[i], text: mapYearData.end_year[i]}, '</option>'))
                                        };
                                        for (var j in mapYearData.start_year){
                                                start_year_select.append($('<option>', {value: mapYearData.start_year[j], text: mapYearData.start_year[j]}, '</option>'))
                                        }
				}
			});
			host = mapYearData.host;
			propAb = propAb;
			propAg = propAg;
		};
		function sequenceRodentMap(){
			var chartPars = {visual: "chart"};
			var mapPars = {visual: "map"};
			$.ajax({async:false, url:"/LassaSequenceRodents", data:chartPars, dataType:"json",
				success: function(data){
					seqData = data;
				}
			});
			$.ajax({async:false, url:"/LassaSequenceRodents", data:mapPars, dataType:"json",
				success: function(data){
					mapYearData = data;
					end_year_select.empty();
					start_year_select.empty();
                                        for (var i in mapYearData.end_year){
                                                end_year_select.append($('<option>', {value: mapYearData.end_year[i], text: mapYearData.end_year[i]}, '</option>'))
                                        };
                                        for (var j in mapYearData.start_year){
                                                start_year_select.append($('<option>', {value: mapYearData.start_year[j], text: mapYearData.start_year[j]}, '</option>'))
                                        }
				}
			});
			seqData = seqData;
			host = mapYearData.host;
		};
                function sequenceHumanMap(){
                        var chartPars = {visual: "chart"};
                        var mapPars = {visual: "map"};
                        $.ajax({async:false, url:"/LassaSequenceHumans", data:chartPars, dataType:"json",
                                success: function(data){
                                        seqData = data;
                                }
                        });
                        $.ajax({async:false, url:"/LassaSequenceHumans", data:mapPars, dataType:"json",
                                success: function(data){
                                        mapYearData = data;
                                        end_year_select.empty();
                                        start_year_select.empty();
                                        for (var i in mapYearData.end_year){
                                                end_year_select.append($('<option>', {value: mapYearData.end_year[i], text: mapYearData.end_year[i]}, '</option>'))
                                        };
                                        for (var j in mapYearData.start_year){
                                                start_year_select.append($('<option>', {value: mapYearData.start_year[j], text: mapYearData.start_year[j]}, '</option>'))
                                        }
                                }
                        });
                        seqData = seqData;
                        host = mapYearData.host;
                };
		$(document).ready(function(){
			$('#SerologyWarn').remove();
			$('#HumanTab').addClass('active');
			humanMap();
			if(window.matchMedia("(max-width: 767px)").matches){
				map.setView([9.531665, 4.460415], 3);
			} else {
				map.setView([10.531665, 0], 5);
			};
			lassaBarChart(host);
			$('#ChartCard').append( "<small id='SerologyWarn' class='form-text text-muted'>*Serology can be ambiguous for arenaviruses.</small>" );
			var SY = document.getElementById("StartYear");
			SY.options[0].selected = true;
			var EY = document.getElementById("EndYear");
			EY.options[EY.options.length - 1].selected = true;
                        var startYear = $('#StartYear').find(":selected").text();
                        var endYear = $('#EndYear').find(":selected").text();
                        var coords = GetFilteredPoints(startYear, endYear, host);
                        MapPoints(coords, host, map);
		});
		$('#HumanTab').on('click', function(){
			$('#SerologyWarn').remove();
                        $('#RodentTab').removeClass('active');
                        $('#SequenceRodentTab').removeClass('active');
                        $('#SequenceHumanTab').removeClass('active');
			$('#HumanTab').addClass('active');
                        humanMap();
			if(window.matchMedia("(max-width: 767px)").matches){
				map.setView([9.531665, 4.460415], 3);
			} else {
				map.setView([10.531665, 0], 5);
			};
                        lassaBarChart(host);
			$('#ChartCard').append( "<small id='SerologyWarn' class='form-text text-muted'>*Serology can be ambiguous for arenaviruses.</small>" );
                        var SY = document.getElementById("StartYear");
                        SY.options[0].selected = true;
                        var EY = document.getElementById("EndYear");
                        EY.options[EY.options.length - 1].selected = true;
                        var startYear = $('#StartYear').find(":selected").text();
                        var endYear = $('#EndYear').find(":selected").text();
                        var coords = GetFilteredPoints(startYear, endYear, host);
                        MapPoints(coords, host, map);
		});
		$('#RodentTab').on('click', function(){
			$('#SerologyWarn').remove();
                        $('#HumanTab').removeClass('active');
                        $('#SequenceRodentTab').removeClass('active');
			$('#SequenceHumanTab').removeClass('active');
			$('#RodentTab').addClass('active');
                        rodentMap();
                        if(window.matchMedia("(max-width: 767px)").matches){
                                map.setView([9.531665, 4.460415], 3);
                        } else {
                                map.setView([10.531665, 0], 5);
                        };
                        lassaBarChart(host);
			$('#ChartCard').append( "<small id='SerologyWarn' class='form-text text-muted'>*Serology can be ambiguous for arenaviruses.</small>" );
                        var SY = document.getElementById("StartYear");
                        SY.options[0].selected = true;
                        var EY = document.getElementById("EndYear");
                        EY.options[EY.options.length - 1].selected = true;
                        var startYear = $('#StartYear').find(":selected").text();
                        var endYear = $('#EndYear').find(":selected").text();
                        var coords = GetFilteredPoints(startYear, endYear, host);
                        MapPoints(coords, host, map);
		});
		$('#SequenceRodentTab').on('click', function(){
			$('#SerologyWarn').remove();
                        $('#RodentTab').removeClass('active');
                        $('#HumanTab').removeClass('active');
			$('#SequenceHumanTab').removeClass('active');
			$('#SequenceRodentTab').addClass('active');
                        sequenceRodentMap();
                        if(window.matchMedia("(max-width: 767px)").matches){
                                map.setView([9.531665, 4.460415], 3);
                        } else {
                                map.setView([10.531665, 0], 5);
                        };
                        lassaBarChart(host);
                        var SY = document.getElementById("StartYear");
                        SY.options[0].selected = true;
                        var EY = document.getElementById("EndYear");
                        EY.options[EY.options.length - 1].selected = true;
                        var startYear = $('#StartYear').find(":selected").text();
                        var endYear = $('#EndYear').find(":selected").text();
                        var coords = GetFilteredPoints(startYear, endYear, host);
                        MapPoints(coords, host, map);
		});
                $('#SequenceHumanTab').on('click', function(){
			$('#SerologyWarn').remove();
                        $('#RodentTab').removeClass('active');
                        $('#HumanTab').removeClass('active');
                        $('#SequenceRodentTab').removeClass('active');
                        $('#SequenceHumanTab').addClass('active');
                        sequenceHumanMap();
                        if(window.matchMedia("(max-width: 767px)").matches){
                                map.setView([9.531665, 4.460415], 3);
                        } else {
                                map.setView([10.531665, 0], 5);
                        };
                        lassaBarChart(host);
                        var SY = document.getElementById("StartYear");
                        SY.options[0].selected = true;
                        var EY = document.getElementById("EndYear");
                        EY.options[EY.options.length - 1].selected = true;
                        var startYear = $('#StartYear').find(":selected").text();
                        var endYear = $('#EndYear').find(":selected").text();
                        var coords = GetFilteredPoints(startYear, endYear, host);
                        MapPoints(coords, host, map);
                });
		start_year_select.on('change', function(){
			getUpdatedEndYear(start_year_select.val(), host);
			var startYear = $('#StartYear').find(":selected").text();
			var endYear = $('#EndYear').find(":selected").text();
			var NewCoords = GetFilteredPoints(startYear, endYear, host);
			MapPoints(NewCoords, host, map);
			end_year_select.on('change', function(){
				var startYear = $('#StartYear').find(":selected").text();
				var startYear = $('#StartYear').find(":selected").text();
				var endYear = $('#EndYear').find(":selected").text();
				var NewCoords = GetFilteredPoints(startYear, endYear, host);
				MapPoints(NewCoords, host, map);
			});
		});
		end_year_select.on('change', function(){
			var startYear = $('#StartYear').find(":selected").text();
			var endYear = $('#EndYear').find(":selected").text();
			var NewCoords = GetFilteredPoints(startYear, endYear, host);
			MapPoints(NewCoords, host, map);
		});
		$(function () {
			var nua = navigator.userAgent
			var isAndroid = (nua.indexOf('Mozilla/5.0') > -1 && nua.indexOf('Android ') > -1 && nua.indexOf('AppleWebKit') > -1 && nua.indexOf('Chrome') === -1)
			if (isAndroid) {
				$('select.form-control').removeClass('form-control').css('width', '100%')
			}
		});
	</script>
	</body>
</html>


