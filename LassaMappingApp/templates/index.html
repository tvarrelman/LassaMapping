<!-- templates/index.html -->
<html>
	<head>
		<link rel="stylesheet" href="/static/bootstrap.css" />
		<title>Lassa Virus Dashboard</title>
		<link rel="stylesheet" href="/static/leaflet.css" />
		<link rel="stylesheet" href="/static/MarkerCluster.css" />
		<link rel="stylesheet" href="/static/MarkerCluster.Default.css" />
		<script src="/static/leaflet.js"></script>
		<script src='/static/leaflet-heat.js'></script>
		<script src='/static/leaflet.markercluster.js'></script>
		<script src='/static/jquery-3.5.1.js'></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
		<script src='/static/bootstrap-tab.js'></script>
		<script src='/static/plotly-latest.min.js'></script>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	<nav class="navbar navbar-expand-lg navbar-light bg-light" role="navigation">
  		<a class="navbar-brand" href="{{ url_for('main_page') }}">Lassa Virus Dashboard</a>
  		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNavBar" aria-controls="mainNavBar" aria-expanded="false" aria-label="Toggle navigation">
    			<span class="navbar-toggler-icon"></span>
  		</button>

		<div class="collapse navbar-collapse" id="mainNavBar">
			<ul class="navbar-nav mr-auto">
				<li class="nav-item">
        				<a class="nav-link" href="{{ url_for('download_page') }}">Download</a>
                                <li class="nav-item">
                                        <a class="nav-link" href="{{ url_for('login') }}">Login</a>
			</ul>
  
		</div>
	</nav>

	<body>
		<!--<div class="spinner-border text-warning" role="status" id="loading">
			<span class="sr-only">Loading...</span>
		</div>-->
		<div class="jumbotron">
		<!--<h2 style="text-align: center">{{message}}</h2>-->
		<p style="text-align: left; max-width: 800px; margin-left: auto; margin-right: auto;">
			The purpose of this dashboard is to provide a comprehensive visualization of Lassa virus across West Africa. To do so, we have compiled and processed a broad data set that describes Lassa virus infection and sequence data across both space and time. Below, we present a summary of our data set followed by a map and barchart that describes one of the following subsets of data: 1.) Lassa infection in humans, 2.) Lassa infection in rodents, 3.) Lassa sequence data from rodent hosts. For further details regarding the mapping and time series barcharts, please see below.  
		</p>
		</div>
		<div class="row justify-content-center">
			<div class="card border-light mb-3 mr-3" style="width: 15rem;">
				<div class="card-body", style="text-align:center;">
					<img src="/static/images/custom_world2.png"></img> <br>
					<p style="color: #1a1a1a">
						<span style="font-size:30px;"><b>{{data_summary[0]}}</b></span><br>
						<span style="font-size:13px;">Countries Represented</span>
					</p>
				</div>
			</div>
			<div class="card border-light mb-3 mr-3" style="width: 15rem;">
				<div class="card-body" style="text-align:center;">
					<img src="/static/images/custom_study2.png"></img><br>
					<p style="color: #1a1a1a">
						<span style="font-size:30px;"><b>{{data_summary[1]}}</b></span><br>
						<span style="font-size:13px;">Source Studies</span>
					</p>
				</div>
			</div>
			<div class="card border-light mb-3 mr-3" style="width: 15rem;">
				<div class="card-body" style="text-align:center;">
					<img src="/static/images/custom_rodent3.png"></img><br>
					<p style="color: #1a1a1a">
						<span style="font-size:30px;"><b>{{data_summary[2]}}</b></span><br>
						<span style="font-size:13px;">Rodent Point Samples</span>
					</p>
				</div>
			</div>
			<div class="card border-light mb-3 mr-3" style="width: 15rem;">
				<div class="card-body" style="text-align:center;">
					<img src="/static/images/custom_human2.png"></img><br>
					<p style="color: #1a1a1a">
						<span style="font-size:30px;"><b>{{data_summary[3]}}</b></span><br>
						<span style="font-size:13px;">Human Point Samples</span>
					</p>
				</div>
			</div>
			<div class="card border-light mb-3 mr-3" style="width: 15rem;">
				<div class="card-body" style="text-align:center;">
					<img src="/static/images/custom_LASV.png"></img><br>
					<p style="color: #1a1a1a">
						<span style="font-size:30px;"><b>{{data_summary[4]}}</b></span><br>
						<span style="font-size:13px;">Lassa Sequences</span>
					</p>
				</div>
			</div>
		</div>
		<div class="container-fluid" id="MainContain">
			<div class="row">
				<div class="col-lg-8" style="height: 485px">
					<div class="card" style="height: 100%" id="mapCard">
						<div class="card-body">
							<p style="text-align: center; color: #1a1a1a"><b>Select a tab below to begin mapping</b> </p>
							<ul class="nav nav-tabs nav-justified" id="myTabs">
								<li class="nav-item" style="margin-left:0px;margin-right:0px; display: flex; flex: 1;">
									<a class="nav-link" id="HumanTab" href="#LassaHumans" style="border-color: #dfdfdf; border-bottom: transparent; flex: 1;">Viral Infection: Humans</a>
								</li>
								<li class="nav-item" style="margin-left:0px;margin-right:0px; display: flex; flex: 1;">
									<a class="nav-link" id="RodentTab" href="#LassaRodents" style="border-color: #dfdfdf; border-bottom: transparent; flex: 1;">Viral Infection: Rodents</a>
								</li>
								<li class="nav-item" style="margin-left:0px;margin-right:0px; display: flex; flex: 1;">
									<a class="nav-link" id="SequenceTab", href="#LassaSequence" style="border-color: #dfdfdf; border-bottom: transparent; flex: 1;">Viral Sequences</a>
								<li>
							</ul>
							<div class="tab-content" id="myTabContent">
  								<div class="tab-pane fade in show active" id="LassaHumans">
									<div id="MapWrapper" style="height: 77%; width:100%; margin:auto">
                                                                        	<div class="row" style="position: absolute; z-index:99; left:75px; bottom:315px;" id="yearFilter">
                                                                                	<div class="form-group" style="width:65px;">
                                                                                        	<label for="StartYear"></label>
                                                                                        	<select class="form-control" name="StartYear" id="StartYear"></select>
                                                                                	</div>
                                                                                	<div class="form-group" style="width:65px;">
                                                                                        	<label for="EndYear"></label>
                                                                                        	<select class="form-control" name="EndYear" id="EndYear"></select>
                                                                                	</div>
                                                                        	</div>
										<div id="map" style="height:100%; width:100%; position: relative; z-index:1;"></div>
									</div>
								</div>
								<div class="tab-pane fade in" id="LassaRodents">
									<div id="map" style="height:100%; width:100%; position: relative; z-index:1;"></div>
								</div>
								<div class="tab-pane fade in" id="LassaSequence">
									<div id="map" style="height:100%; width:100%; position: relative; z-index:1;"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-lg-4" style="height: 485px">
					<div class="card" style="height: 100%">
						<div class="card-body">
							<div id='myDiv' style="width:100%"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	<script src="/static/lassaMapping.js" type="text/javascript"></script>
	<script>
		$(window).on("resize", function(){
                        var filterTop = $('#map').position().top + 4;
                        var filterLeft = $('#map').position().left + 55;
                        $('#yearFilter').css({'top': filterTop, 'left':filterLeft});
		});
		var mapOptions = {};
		$(document).ready(function(){
    			if(window.matchMedia("(max-width: 767px)").matches){
        		// The viewport is less than 768 pixels wide
				var newMapHeight = $('#map').height() - 44;
				$('#map').css({'height': newMapHeight});
    			} else{
        		// The viewport is at least 768 pixels wide
                        	var filterTop = $('#map').position().top + 4;
                        	var filterLeft = $('#map').position().left + 55;
                        	$('#yearFilter').css({'top': filterTop, 'left':filterLeft});
    			}
		});
		//$(window).load(function() {
		//	$('#loading').hide();
		//});
		var host = {};
		var propAb = {};
		var propAg = {};
		function humanMap(){
			var chartPars = {visual: "chart"};
			var mapPars = {visual: "map"};
			$.ajax({async:false, url:"/LassaHumans", data:chartPars, dataType:"json",
				success: function(data){
					propAb = data;
				}
			});
			$.ajax({async:false, url:"/LassaHumans", data:mapPars, dataType:"json",
				success: function(data){
					mapYearData = data;
                                        end_year_select.empty();
                                        start_year_select.empty();
					for (var i in mapYearData.end_year){
						end_year_select.append($('<option>', {value: mapYearData.end_year[i], text: mapYearData.end_year[i]}, '</option>'))
					};
					for (var j in mapYearData.start_year){
						start_year_select.append($('<option>', {value: mapYearData.start_year[j], text: mapYearData.start_year[j]}, '</option>'))
					}
				}
			});
			host = mapYearData.host;
			propAb = propAb;
		};
		function rodentMap(){
			var chartPars = {visual: "chart"};
			var mapPars = {visual: "map"};
			$.ajax({async:false, url:"/LassaRodents", data:chartPars, dataType:"json",
				success: function(data){
					propAb = data[0];
					propAg = data[1];
				}
			});
			$.ajax({async:false, url:"/LassaRodents", data:mapPars, dataType:"json",
				success: function(data){
					mapYearData = data;
                                        end_year_select.empty();
                                        start_year_select.empty();
                                        for (var i in mapYearData.end_year){
                                                end_year_select.append($('<option>', {value: mapYearData.end_year[i], text: mapYearData.end_year[i]}, '</option>'))
                                        };
                                        for (var j in mapYearData.start_year){
                                                start_year_select.append($('<option>', {value: mapYearData.start_year[j], text: mapYearData.start_year[j]}, '</option>'))
                                        }
				}
			});
			host = mapYearData.host;
			propAb = propAb;
			propAg = propAg;
		};
		function sequenceMap(){
			var chartPars = {visual: "chart"};
			var mapPars = {visual: "map"};
			$.ajax({async:false, url:"/LassaSequence", data:chartPars, dataType:"json",
				success: function(data){
					seqData = data;
				}
			});
			$.ajax({async:false, url:"/LassaSequence", data:mapPars, dataType:"json",
				success: function(data){
					mapYearData = data;
					end_year_select.empty();
					start_year_select.empty();
                                        for (var i in mapYearData.end_year){
                                                end_year_select.append($('<option>', {value: mapYearData.end_year[i], text: mapYearData.end_year[i]}, '</option>'))
                                        };
                                        for (var j in mapYearData.start_year){
                                                start_year_select.append($('<option>', {value: mapYearData.start_year[j], text: mapYearData.start_year[j]}, '</option>'))
                                        }
				}
			});
			seqData = seqData;
			host = mapYearData.host;
		};
		$(document).ready(function(){
			$('#HumanTab').addClass('active');
			humanMap();
			lassaBarChart(host);
			var SY = document.getElementById("StartYear");
			SY.options[0].selected = true;
			var EY = document.getElementById("EndYear");
			EY.options[EY.options.length - 1].selected = true;
                        var startYear = $('#StartYear').find(":selected").text();
                        var endYear = $('#EndYear').find(":selected").text();
                        var coords = GetFilteredPoints(startYear, endYear, host);
                        MapPoints(coords, host, map);
		});
		$('#HumanTab').on('click', function(){
                        $('#RodentTab').removeClass('active');
			$('#SequenceTab').removeClass('active');
			$('#HumanTab').addClass('active');
                        humanMap();
                        lassaBarChart(host);
                        var SY = document.getElementById("StartYear");
                        SY.options[0].selected = true;
                        var EY = document.getElementById("EndYear");
                        EY.options[EY.options.length - 1].selected = true;
                        var startYear = $('#StartYear').find(":selected").text();
                        var endYear = $('#EndYear').find(":selected").text();
                        var coords = GetFilteredPoints(startYear, endYear, host);
                        MapPoints(coords, host, map);
		});
		$('#RodentTab').on('click', function(){
                        $('#HumanTab').removeClass('active');
                        $('#SequenceTab').removeClass('active');
			$('#RodentTab').addClass('active');
                        rodentMap();
                        lassaBarChart(host);
                        var SY = document.getElementById("StartYear");
                        SY.options[0].selected = true;
                        var EY = document.getElementById("EndYear");
                        EY.options[EY.options.length - 1].selected = true;
                        var startYear = $('#StartYear').find(":selected").text();
                        var endYear = $('#EndYear').find(":selected").text();
                        var coords = GetFilteredPoints(startYear, endYear, host);
                        MapPoints(coords, host, map);
		});
		$('#SequenceTab').on('click', function(){
                        $('#RodentTab').removeClass('active');
                        $('#HumanTab').removeClass('active');
			$('#SequenceTab').addClass('active');
                        sequenceMap();
                        lassaBarChart(host);
                        var SY = document.getElementById("StartYear");
                        SY.options[0].selected = true;
                        var EY = document.getElementById("EndYear");
                        EY.options[EY.options.length - 1].selected = true;
                        var startYear = $('#StartYear').find(":selected").text();
                        var endYear = $('#EndYear').find(":selected").text();
                        var coords = GetFilteredPoints(startYear, endYear, host);
                        MapPoints(coords, host, map);
		});
		start_year_select.on('change', function(){
			getUpdatedEndYear(start_year_select.val(), host);
			var startYear = $('#StartYear').find(":selected").text();
			var endYear = $('#EndYear').find(":selected").text();
			var NewCoords = GetFilteredPoints(startYear, endYear, host);
			//console.log(NewCoords);
			MapPoints(NewCoords, host, map);
			end_year_select.on('change', function(){
				var startYear = $('#StartYear').find(":selected").text();
				var startYear = $('#StartYear').find(":selected").text();
				var endYear = $('#EndYear').find(":selected").text();
				var NewCoords = GetFilteredPoints(startYear, endYear, host);
				MapPoints(NewCoords, host, map);
			});
		});
		end_year_select.on('change', function(){
			var startYear = $('#StartYear').find(":selected").text();
			var endYear = $('#EndYear').find(":selected").text();
			var NewCoords = GetFilteredPoints(startYear, endYear, host);
			MapPoints(NewCoords, host, map);
		});
	</script>
	<script src = "/static/lassaCharts.js" type="text/javascript"></script>
	</body>
</html>


